FROM tindy2013/subconverter:latest
COPY base/base /base/
COPY scripts/crontab /tmp
RUN sed -i '/TW/s/ðŸ‡¨ðŸ‡³/ðŸ‡¹ðŸ‡¼/g' /base/snippets/emoji.txt && \
    sed -i '/TW/{n;s/ðŸ‡¨ðŸ‡³/ðŸ‡¹ðŸ‡¼/g;}' /base/snippets/emoji.toml && \
    sed -i '/æ—¥æœ¬/s/\^-/\^-å°¼/g' /base/snippets/emoji.txt && \
    sed -i '/æ—¥æœ¬/s/\^-/\^-å°¼/g' /base/snippets/emoji.toml

RUN apk --update add tzdata && \
    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone
    
RUN apk add git && \
    apk add wget && \
    cd /base/rules && git clone https://github.com/pengfujin-momo/myself.git && \
    cd /base/rules/myself/clash/list/ && wget -i url.list && \    
    cat /tmp/crontab >> /var/spool/cron/crontabs/root && \
    rm -rf /tmp/* && \
    rm -rf /var/cache/apk/*

EXPOSE 25500
WORKDIR /base
CMD crond && subconverter
